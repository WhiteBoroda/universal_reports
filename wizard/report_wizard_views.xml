<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ИСПРАВЛЕННЫЙ wizard/report_wizard_views.xml -->

    <!-- Форма майстера експорту -->
    <record id="view_report_export_wizard_form" model="ir.ui.view">
        <field name="name">report.export.wizard.form</field>
        <field name="model">universal.report.export.wizard</field>
        <field name="arch" type="xml">
            <form string="Експорт звіту">
                <sheet>
                    <div class="oe_title">
                        <h2>
                            <field name="report_id" readonly="1"
                                   options="{'no_open': True}"/>
                        </h2>
                        <h3>Майстер експорту</h3>
                    </div>

                    <!-- Вибір формату -->
                    <group string="Формат експорту">
                        <field name="export_format" widget="radio"
                               options="{'horizontal': true}"/>
                    </group>

                    <!-- Налаштування Excel -->
                    <group string="Налаштування Excel"
                           invisible="export_format != 'excel'">
                        <group>
                            <field name="excel_sheet_name"/>
                            <field name="excel_include_charts"/>
                        </group>
                        <group>
                            <field name="excel_freeze_header"/>
                            <field name="excel_auto_filter"/>
                        </group>
                    </group>

                    <!-- Налаштування CSV -->
                    <group string="Налаштування CSV"
                           invisible = "export_format != 'csv'">
                        <group>
                            <field name="csv_delimiter"/>
                            <field name="csv_encoding"/>
                        </group>
                        <group>
                            <field name="csv_include_headers"/>
                        </group>
                    </group>

                    <!-- Налаштування PDF -->
                    <group string="Налаштування PDF"
                           invisible = "export_format != 'pdf'">
                        <group>
                            <field name="pdf_orientation"/>
                            <field name="pdf_page_size"/>
                        </group>
                        <group>
                            <field name="pdf_include_logo"/>
                        </group>
                    </group>

                    <!-- Фільтрування та обмеження -->
                    <group string="Фільтрування даних">
                        <field name="include_filters"/>
                        <field name="custom_filters" widget="text"
                               placeholder='[{"field": "active", "operator": "=", "value": true}]'
                               help="Додаткові фільтри у форматі JSON"/>
                        <field name="limit_records"
                               help="0 = без обмежень"/>
                    </group>

                    <!-- Результат експорту -->
                    <group string="Результат"
                           invisible="not result_file">
                        <field name="result_filename" readonly="1"/>
                        <field name="result_file" filename="result_filename" readonly="1"/>
                        <field name="export_log" widget="text" readonly="1"
                               invisible="not export_log"/>
                    </group>
                </sheet>

                <footer>
                    <button name="action_export" type="object"
                            string="Експортувати" class="btn-primary"
                            invisible="result_file"/>
                    <button name="action_download" type="object"
                            string="Завантажити файл" class="btn-success"
                            invisible="not result_file"/>
                    <button name="action_reset" type="object"
                            string="Новий експорт" class="btn-secondary"
                            invisible="not result_file"/>
                    <button string="Закрити" special="cancel" class="btn-secondary"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Форма майстера виконання звіту -->
    <record id="view_universal_report_wizard_form" model="ir.ui.view">
        <field name="name">universal.report.wizard.form</field>
        <field name="model">universal.report.wizard</field>
        <field name="arch" type="xml">
            <form string="Виконання звіту">
                <sheet>
                    <div class="oe_title">
                        <h2>
                            <field name="report_id" readonly="1"
                                   options="{'no_open': True}"/>
                        </h2>
                        <h3>Майстер виконання звіту</h3>
                    </div>

                    <!-- Налаштування виконання -->
                    <group string="Параметри виконання">
                        <group>
                            <field name="export_format"/>
                            <field name="limit_records"
                                   help="0 = без обмежень"/>
                        </group>
                        <group>
                            <field name="state" readonly="1"/>
                            <field name="result_count" readonly="1"
                                   invisible="result_count == 0"/>
                            <field name="execution_time" readonly="1"
                                  invisible = "execution_time == 0"/>
                        </group>
                    </group>

                    <!-- Додаткові фільтри -->
                    <group string="Додаткові фільтри"
                           invisible="state in ['executing']">
                        <field name="filter_values" widget="text"
                               placeholder='[{"field": "active", "operator": "=", "value": true}]'
                               help="JSON з додатковими фільтрами"/>
                    </group>

                    <!-- Попередній перегляд -->
                    <group string="Попередній перегляд"
                           invisible="export_format != 'preview' or not result_data">
                        <field name="result_data" widget="text" readonly="1"
                               height="300" string=""/>
                    </group>

                    <!-- Файл для завантаження -->
                    <group string="Результат експорту"
                           invisible="not result_file">
                        <field name="result_filename" readonly="1"/>
                        <field name="result_file" filename="result_filename" readonly="1"/>
                    </group>

                    <!-- Помилки -->
                    <group string="Помилка"
                           invisible="state != 'error'">
                        <field name="error_message" widget="text" readonly="1"
                               class="text-danger"/>
                    </group>
                </sheet>

                <footer>
                    <button name="action_execute" type="object"
                            string="Виконати" class="btn-primary"
                            invisible="state in ['executing', 'done']"/>
                    <button name="action_download_file" type="object"
                            string="Завантажити файл" class="btn-success"
                            invisible="not result_file"/>
                    <button name="action_back_to_report" type="object"
                            string="Повернутися до звіту" class="btn-info"/>
                    <button name="action_close" type="object"
                            string="Закрити" class="btn-secondary"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Простий майстер швидкого експорту -->
    <record id="view_quick_export_wizard_form" model="ir.ui.view">
        <field name="name">quick.export.wizard.form</field>
        <field name="model">universal.report.wizard</field>
        <field name="arch" type="xml">
            <form string="Швидкий експорт">
                <sheet>
                    <div class="alert alert-info" role="alert">
                        <strong>Швидкий експорт</strong><br/>
                        Виберіть формат для миттєвого експорту звіту
                    </div>

                    <group>
                        <field name="report_id" readonly="1" invisible="1"/>
                        <field name="export_format" widget="radio"
                               options="{'horizontal': false}"/>
                        <field name="limit_records" string="Обмежити записи"/>
                    </group>
                </sheet>

                <footer>
                    <button name="action_execute" type="object"
                            string="Експортувати та завантажити" class="btn-primary"/>
                    <button string="Скасувати" special="cancel" class="btn-secondary"/>
                </footer>
            </form>
        </field>
    </record>



    <!-- Майстер копіювання звіту -->
    <record id="view_copy_report_wizard_form" model="ir.ui.view">
        <field name="name">copy.report.wizard.form</field>
        <field name="model">universal.report.builder</field>
        <field name="arch" type="xml">
            <form string="Копіювання звіту">
                <sheet>
                    <div class="oe_title">
                        <h2>Копіювання звіту</h2>
                        <p>Створення копії з можливістю змінити налаштування</p>
                    </div>

                    <group>
                        <field name="name" string="Нова назва" required="1"/>
                        <field name="description" string="Новий опис"/>
                        <field name="is_template" string="Зберегти як шаблон"/>
                    </group>
                </sheet>

                <footer>
                    <button name="action_duplicate" type="object"
                            string="Створити копію" class="btn-primary"/>
                    <button string="Скасувати" special="cancel" class="btn-secondary"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Майстер планувальника -->
    <record id="view_scheduler_wizard_form" model="ir.ui.view">
        <field name="name">scheduler.wizard.form</field>
        <field name="model">universal.report.scheduler</field>
        <field name="arch" type="xml">
            <form string="Створення планувальника">
                <sheet>
                    <div class="oe_title">
                        <h2>Створення планувальника звітів</h2>
                        <p>Налаштуйте автоматичне виконання звіту</p>
                    </div>

                    <group>
                        <group>
                            <field name="name" required="1"/>
                            <field name="report_id" readonly="1"
                                   options="{'no_open': True}"/>
                        </group>
                        <group>
                            <label for="interval_number"/>
                            <div class="o_row">
                                <field name="interval_number" class="oe_inline" required="1"/>
                                <field name="interval_type" class="oe_inline" required="1"/>
                            </div>
                            <field name="execution_time" widget="float_time" required="1"/>
                        </group>
                    </group>

                    <group string="Email сповіщення">
                        <field name="email_recipients"
                               placeholder="user1@example.com&#10;user2@example.com"/>
                        <field name="attach_report"/>
                    </group>
                </sheet>

                <footer>
                    <button name="%(action_universal_report_scheduler)d" type="action"
                            string="Створити планувальник" class="btn-primary"
                            context="{'default_name': name, 'default_report_id': report_id}"/>
                    <button string="Скасувати" special="cancel" class="btn-secondary"/>
                </footer>
            </form>
        </field>
    </record>

    <record id="action_quick_export_wizard" model="ir.actions.act_window">
        <field name="name">Швидкий експорт</field>
        <field name="res_model">universal.report.wizard</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_quick_export_wizard_form"/>
        <field name="target">new</field>
    </record>

    <record id="action_copy_report_wizard" model="ir.actions.act_window">
        <field name="name">Копіювати звіт</field>
        <field name="res_model">universal.report.builder</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_copy_report_wizard_form"/>
        <field name="target">new</field>
    </record>

    <record id="action_report_export_wizard" model="ir.actions.act_window">
        <field name="name">Експорт звіту</field>
        <field name="res_model">universal.report.export.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>


</odoo>